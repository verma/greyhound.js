(function e$$0(g,h,f){function k(b,e){if(!h[b]){if(!g[b]){var d="function"==typeof require&&require;if(!e&&d)return d(b,!0);if(a)return a(b,!0);throw Error("Cannot find module '"+b+"'");}d=h[b]={exports:{}};g[b][0].call(d.exports,function(d){var a=g[b][1][d];return k(a?a:d)},d,d.exports,e$$0,g,h,f)}return h[b].exports}for(var a="function"==typeof require&&require,b=0;b<f.length;b++)k(f[b]);return k})({1:[function(c,g,h){c=c("../src/greyhound");g.exports={GreyhoundReader:c.GreyhoundReader,Schema:c.Schema}},
{"../src/greyhound":2}],2:[function(c,g,h){var f=function(){var a=[],b=function(b,e,d){e=e||"floating";d=d||4;return function(l,c){l=l||e;c=c||d;a.push({name:b,type:l,size:c});return a}};a.X=b("X");a.Y=b("Y");a.Z=b("Z");a.Intensity=b("Intensity","unsigned",2);a.Red=b("Red","unsigned",2);a.Green=b("Green","unsigned",2);a.Blue=b("Blue","unsigned",2);return a};f.standard=function(){return f().X().Y().Z().Intensity().Red().Green().Blue()};f.XYZ=function(){return f().X().Y().Z()};c=function(a){if(!a)throw Error("Need hostname to initialize reader");
if(a.match(/^(\S+):\/\//))throw Error("Protocol specified, need bare hostname");this.host=a;a=this.host.match(/:(\d+)$/);this.port=null!==a?parseInt(a[1]):80;if(a=this.host.match(/^(\S+):/))this.host=a[1]};var k=function(a){setTimeout(a)};c.prototype.getHost=function(){return this.host};c.prototype.createSession=function(a,b){if(!a||"function"===typeof a)throw Error("Invalid pipeline");this._withConn(function(c,e){if(c)return b(c);e.cmd({command:"create",pipelineId:a},function(d,a){if(d)return b(d);
console.log("Got stuff",d,a);b(null,a.session)})})};c.prototype.read=function(a,b,c){if(!a||"function"===typeof a)throw Error("Invalid session parameter");console.log(typeof b);"function"===typeof b&&(c=b,b={});b=b.schema||f.standard();console.log("schema: ",b);var e={command:"read",session:a,schema:{dimensions:b}};this._withConn(function(b,a){if(b)return c(b);a.cmd(e,function(b,d){if(b)return c(b);a.readBinary(d.numBytes,function(b,a){if(b)return c(b);c(null,{numPoints:d.numPoints,numBytes:d.numBytes,
data:a})})})})};c.prototype.destroy=function(a,b){if(!a||"function"===typeof a)throw Error("Invalid session parameter");this._withConn(function(c,e){if(c)return b(c);e.cmd({command:"destroy",session:a},function(d,a){if(d)return b(d);b()})})};c.prototype.getPort=function(){return this.port};c.prototype._withConn=function(a){if(this.conn)return k(a.bind(null,null,this.conn));var b=this,c="ws://"+this.getHost()+":"+this.getPort()+"/";console.log("Using URI:",c);var e=new WebSocket(c);e.binaryType="arraybuffer";
console.log("Creating websocket");this.binary=null;e.onopen=function(){console.log("on open");b.ws=e;b.handlers={};b.conn={cmd:function(d,a){if(d.command)b.handlers[d.command]=a,b.ws.send(JSON.stringify(d));else{var c=a.bind(null,Error("No command parameter"));setTimeout(c)}},readBinary:function(a,c){b.binary={sofar:0,bytesLeft:a,dataBuffer:new Int8Array(a),cb:c}}};console.log("Opened!");k(a.bind(null,null,b.conn))};e.onerror=function(){b.ws=null;for(var d in b.handlers)b.handlers[d](Error("Connection error"));
console.log("Dispatching error function");d=a.bind(null,Error("Connection error"));setTimeout(d)};e.onclose=function(){b.ws=null};e.onmessage=function(a){if(a.data instanceof ArrayBuffer){console.log("on binary");if(!b.binary)return console.log("Got binary when no binary transmission in progress");a=new Int8Array(a.data);b.binary.dataBuffer.set(a,b.binary.sofar);b.binary.sofar+=a.length;b.binary.bytesLeft-=a.length;if(0>=b.binary.bytesLeft){a=b.binary.dataBuffer;var c=b.binary.cb;b.binary=null;a=
c.bind(null,null,a);setTimeout(a)}}else if(console.log("on data message"),console.log(a),a=JSON.parse(a.data),c=a.command){var e=b.handlers[c];e&&(delete b.handlers[c],1!==a.status?(a=e.bind(null,Error(a.reason||"Unknown Error")),setTimeout(a)):e(null,a))}};console.log("Ive setup everything, waiting for notifications now");this.ws=e};g.exports={Schema:f,GreyhoundReader:c}},{}]},{},[1]);
